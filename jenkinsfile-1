pipeline {
    agent any
    stages {
        stage('Semgrep Scan') {
            steps {
                sh '''
                    # Installation et scan minimal
                    python3 -m pip install semgrep 2>/dev/null || true
                    semgrep scan --config auto --quiet . 2>&1 || echo "Scan termin√©"
                '''
            }
        }
        
        stage('Sonar Scan') {
            steps {
                dir('SecurityService') {
                    withSonarQubeEnv('sq1') {
                        sh 'chmod +x mvnw && ./mvnw clean verify -DskipTests sonar:sonar'
                    }
                }
            }
        }
    }
}
