pipeline {
  agent any

  stages {
    stage('Checkout') {
      steps { 
        checkout scm 
      }
    }

    stage('OWASP Dependency-Check') {
      steps {
        dir('SecurityService') {
          bat '''
            mvn -B org.owasp:dependency-check-maven:check ^
              -Dformat=HTML ^
              -Dformat=JSON ^
              -DfailBuildOnCVSS=7 ^
              -DfailOnError=true ^
              -DskipTests ^
              -DoutputDirectory=./target/security-reports
          '''
        }
      }
      post {
        always {
          // Sauvegarder les rapports
          archiveArtifacts 'SecurityService/target/security-reports/**'
          
          // Alternative : juste le HTML
          archiveArtifacts 'SecurityService/target/dependency-check-report.html'
        }
      }
    }
  }
}
