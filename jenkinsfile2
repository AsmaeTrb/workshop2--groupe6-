pipeline {
  agent any

  stages {
    stage('Checkout') {
      steps { 
        checkout scm 
      }
    }

    stage('Build (sans tests)') {
      steps {
        dir('SecurityService') {
          bat 'mvn -B clean package -DskipTests'
        }
      }
    }

    stage('OWASP Dependency-Check (Offline)') {
      steps {
        dir('SecurityService') {
          bat '''
            echo Mode OFFLINE - utilisation des donn√©es locales...
            
            mvn -B org.owasp:dependency-check-maven:check ^
              -Dformat=HTML ^
              -Dformat=JSON ^
              -DfailBuildOnCVSS=7 ^
              -DautoUpdate=false ^
              -DnvdApiDelay=0 ^
              --no-transfer-progress
          '''
        }
      }
      post {
        always {
          archiveArtifacts artifacts: 'SecurityService/target/dependency-check-report.*', 
            allowEmptyArchive: true
        }
      }
    }
  }
}
